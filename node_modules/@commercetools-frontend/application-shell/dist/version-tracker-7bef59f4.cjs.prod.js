'use strict';

var react = require('react');
var applicationShellConnectors = require('@commercetools-frontend/application-shell-connectors');
var sdk = require('@commercetools-frontend/sdk');
var dist_commercetoolsFrontendApplicationShell = require('./index-ae549827.cjs.prod.js');
var _JSON$stringify = require('@babel/runtime-corejs3/core-js-stable/json/stringify');
var constants = require('@commercetools-frontend/constants');
require('prop-types');
require('react-router-dom');
require('./index-6cd618cc.cjs.prod.js');
require('@babel/runtime-corejs3/core-js-stable/object/keys');
require('@babel/runtime-corejs3/core-js-stable/object/get-own-property-symbols');
require('@babel/runtime-corejs3/core-js-stable/instance/filter');
require('@babel/runtime-corejs3/core-js-stable/object/get-own-property-descriptor');
require('@babel/runtime-corejs3/core-js-stable/instance/for-each');
require('@babel/runtime-corejs3/core-js-stable/object/get-own-property-descriptors');
require('@babel/runtime-corejs3/core-js-stable/object/define-properties');
require('@babel/runtime-corejs3/core-js-stable/object/define-property');
require('@babel/runtime-corejs3/helpers/defineProperty');
require('@babel/runtime-corejs3/helpers/slicedToArray');
require('@babel/runtime-corejs3/core-js-stable/instance/reduce');
require('@babel/runtime-corejs3/core-js-stable/object/entries');
require('@babel/runtime-corejs3/core-js-stable/reflect/has');
require('@reduxjs/toolkit');
require('lodash/mapValues');
require('omit-empty-es');
require('redux-thunk');
require('@commercetools-frontend/notifications');
require('@babel/runtime-corejs3/core-js-stable/instance/index-of');
require('@babel/runtime-corejs3/core-js-stable/instance/slice');
require('@babel/runtime-corejs3/core-js-stable/instance/includes');
require('@commercetools-frontend/sentry');
require('@commercetools-frontend/react-notifications');
require('@babel/runtime-corejs3/core-js-stable/instance/starts-with');
require('redux-logger');
require('@emotion/styled/base');
require('@babel/runtime-corejs3/core-js-stable/instance/find');
require('@babel/runtime-corejs3/core-js-stable/array/is-array');
require('@emotion/react');
require('@commercetools-frontend/application-components');
require('@commercetools-frontend/i18n');
require('./oidc-b070ff6c.cjs.prod.js');
require('@babel/runtime-corejs3/core-js-stable/instance/concat');
require('@babel/runtime-corejs3/core-js-stable/instance/map');
require('@babel/runtime-corejs3/core-js-stable/url');
require('@commercetools-uikit/design-system');
require('@commercetools-uikit/spacings');
require('react-intl');
require('@commercetools-uikit/flat-button');
require('@commercetools-uikit/icons');
require('./use-is-served-by-proxy-845cace5.cjs.prod.js');
require('@emotion/react/jsx-runtime');
require('@babel/runtime-corejs3/helpers/taggedTemplateLiteral');
require('@babel/runtime-corejs3/helpers/objectDestructuringEmpty');
require('@babel/runtime-corejs3/helpers/extends');
require('memoize-one');
require('react-select');
require('@commercetools-uikit/accessible-hidden');
require('@commercetools-uikit/select-input');
require('@commercetools-frontend/assets/images/ct-logo.svg');
require('@commercetools-uikit/loading-spinner');
require('@commercetools-frontend/browser-history');
require('@commercetools-frontend/l10n');
require('@babel/runtime-corejs3/core-js-stable/reflect/construct');
require('@babel/runtime-corejs3/helpers/classCallCheck');
require('@babel/runtime-corejs3/helpers/createClass');
require('@babel/runtime-corejs3/helpers/inherits');
require('@babel/runtime-corejs3/helpers/possibleConstructorReturn');
require('@babel/runtime-corejs3/helpers/getPrototypeOf');
require('@babel/runtime-corejs3/core-js-stable/object/from-entries');
require('@babel/runtime-corejs3/core-js-stable/instance/flags');
require('@apollo/client/react');
require('@flopflip/combine-adapters');
require('@flopflip/http-adapter');
require('@flopflip/launchdarkly-adapter');
require('@flopflip/react-broadcast');
require('react-redux');
require('lodash/upperFirst');
require('@commercetools-uikit/design-system/materials/resets.css');
require('@commercetools-frontend/application-config/ssr');
require('@commercetools-frontend/permissions');
require('@babel/runtime-corejs3/core-js-stable/instance/some');
require('@commercetools-frontend/actions-global');

function _interopDefault (e) { return e && e.__esModule ? e : { 'default': e }; }

var _JSON$stringify__default = /*#__PURE__*/_interopDefault(_JSON$stringify);

// eslint-disable-next-line import/prefer-default-export
const pushDependencyVersionCounter = _ref => {
  let payload = _ref.payload;
  return sdk.actions.post({
    uri: '/metrics/counters',
    mcApiProxyTarget: constants.MC_API_PROXY_TARGETS.MC_METRICS,
    payload: _JSON$stringify__default["default"](payload)
  });
};

const createVersionMetric = _ref => {
  let applicationName = _ref.applicationName;
  return [{
    metricName: 'npm_dependency_versions',
    metricLabels: {
      application: applicationName,
      package_name: '@commercetools-frontend/application-shell',
      package_version: dist_commercetoolsFrontendApplicationShell.applicationShellVersion
    }
  }, {
    metricName: 'npm_dependency_versions',
    metricLabels: {
      application: applicationName,
      package_name: 'react',
      package_version: react.version
    }
  }];
};
const VersionTracker = () => {
  const applicationName = applicationShellConnectors.useApplicationContext(context => context.environment.applicationName);
  const dispatch = sdk.useAsyncDispatch();
  react.useEffect(() => {
    dispatch(pushDependencyVersionCounter({
      payload: createVersionMetric({
        applicationName
      })
    })).catch(() => {
      // Error is ignored under the assumption that page is being
      // reloaded whilst the request was being sent or network request was interrupted
    });
  }, [applicationName, dispatch]);
  return null;
};
VersionTracker.displayName = 'VersionTracker';

exports["default"] = VersionTracker;
